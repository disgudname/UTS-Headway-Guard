{
  "permissions": {
    "allow": [
      "Bash(python:*)",
      "Bash(node --check:*)",
      "Bash(fly logs:*)",
      "Bash(flyctl logs:*)",
      "Bash(dir:*)",
      "Bash(git show:*)",
      "Bash(grep:*)",
      "Bash(powershell -Command:*)",
      "Bash(where:*)",
      "Bash(pip install beautifulsoup4 lxml -q)",
      "Bash(pip install:*)",
      "Bash(del \"C:\\\\Users\\\\Pat Cox\\\\Documents\\\\GitHub\\\\UTS-Headway-Guard\\\\nul\")",
      "Bash(cd:*)",
      "Bash(cat:*)",
      "Bash(curl:*)",
      "Bash(xxd:*)",
      "Bash(ls:*)",
      "Bash(xargs:*)",
      "WebSearch",
      "WebFetch(domain:sdk.viriciti.com)",
      "WebFetch(domain:utsopsdashboard.com)",
      "Bash(flyctl deploy:*)",
      "Bash(flyctl auth login:*)",
      "Bash(flyctl status:*)",
      "WebFetch(domain:api-v3.amtraker.com)",
      "WebFetch(domain:unpkg.com)",
      "WebFetch(domain:web.archive.org)",
      "Bash(python3:*)",
      "Bash(node -e:*)",
      "Bash(node --input-type=module:*)",
      "WebFetch(domain:novanexsolutions.com)",
      "WebFetch(domain:www.alertus.com)",
      "Bash(head:*)",
      "Bash(where python3 2>/dev/null || where python 2>/dev/null || py --version 2>/dev/null)",
      "Bash(python3 --version 2>/dev/null || python --version 2>/dev/null || py --version 2>/dev/null)",
      "Bash(curl -s -b /tmp/uts_fb.txt \"https://utsopsdashboard.com/api/fullbus?start=2026-02-01T00:00:00Z&end=2026-02-25T23:59:59Z\" | python3.exe -c \"\nimport sys, json\nfrom datetime import datetime, timezone\n\nd = json.load\\(sys.stdin\\)\nevents = d.get\\('events', []\\) + d.get\\('active', []\\)\nprint\\(f'Total events: {len\\(events\\)}'\\)\n\n# Separate by vehicle\nby_vehicle = {}\nfor ev in events:\n    name = ev.get\\('vehicle_name'\\) or ev.get\\('vehicle_id'\\) or 'unknown'\n    by_vehicle.setdefault\\(name, []\\).append\\(ev\\)\n\nprint\\(f'\\\\nEvent count by vehicle:'\\)\nfor name, evs in sorted\\(by_vehicle.items\\(\\), key=lambda x: -len\\(x[1]\\)\\):\n    print\\(f'  {name}: {len\\(evs\\)} events'\\)\n\n# Deep dive on 18332\nevs_18332 = by_vehicle.get\\('18332', []\\)\nprint\\(f'\\\\n=== DEEP DIVE: bus 18332 \\({len\\(evs_18332\\)} events\\) ==='\\)\n\n# Duration stats\ndurations = []\nfor ev in evs_18332:\n    try:\n        s = datetime.fromisoformat\\(ev['start_time'].replace\\('Z','+00:00'\\)\\)\n        e = datetime.fromisoformat\\(ev['end_time'].replace\\('Z','+00:00'\\)\\)\n        dur = \\(e - s\\).total_seconds\\(\\)\n        durations.append\\(dur\\)\n    except:\n        durations.append\\(None\\)\n\nvalid_dur = [d for d in durations if d is not None]\nif valid_dur:\n    print\\(f'Duration stats \\(seconds\\):'\\)\n    print\\(f'  min={min\\(valid_dur\\):.0f}s  max={max\\(valid_dur\\):.0f}s  avg={sum\\(valid_dur\\)/len\\(valid_dur\\):.0f}s  median={sorted\\(valid_dur\\)[len\\(valid_dur\\)//2]:.0f}s'\\)\n    very_short = [d for d in valid_dur if d < 30]\n    print\\(f'  Episodes under 30s: {len\\(very_short\\)} \\({100*len\\(very_short\\)//len\\(valid_dur\\)}%\\)'\\)\n    very_long = [d for d in valid_dur if d > 300]\n    print\\(f'  Episodes over 5min: {len\\(very_long\\)} \\({100*len\\(very_long\\)//len\\(valid_dur\\)}%\\)'\\)\n\n# Peak occupation stats\npeaks = [ev.get\\('peak_occupation'\\) for ev in evs_18332 if ev.get\\('peak_occupation'\\) is not None]\ncapacity = evs_18332[0].get\\('capacity', 50\\) if evs_18332 else 50\nif peaks:\n    print\\(f'Peak occupation \\(capacity={capacity}\\):'\\)\n    print\\(f'  min={min\\(peaks\\)}  max={max\\(peaks\\)}  avg={sum\\(peaks\\)/len\\(peaks\\):.1f}'\\)\n    extreme = [p for p in peaks if p > capacity * 1.3]\n    print\\(f'  Suspiciously high \\(>130% capacity\\): {len\\(extreme\\)} events, values: {sorted\\(extreme, reverse=True\\)[:10]}'\\)\n\n# Time of day distribution\nprint\\(f'\\\\nTime of day distribution \\(ET, rough\\):'\\)\nhour_counts = {}\nfor ev in evs_18332:\n    try:\n        s = datetime.fromisoformat\\(ev['start_time'].replace\\('Z','+00:00'\\)\\)\n        # Approx ET = UTC-5\n        hour = \\(s.hour - 5\\) % 24\n        hour_counts[hour] = hour_counts.get\\(hour, 0\\) + 1\n    except:\n        pass\nfor h in sorted\\(hour_counts\\):\n    bar = '#' * hour_counts[h]\n    print\\(f'  {h:02d}:00  {bar} \\({hour_counts[h]}\\)'\\)\n\n# Date distribution\nprint\\(f'\\\\nDate distribution:'\\)\ndate_counts = {}\nfor ev in evs_18332:\n    try:\n        s = datetime.fromisoformat\\(ev['start_time'].replace\\('Z','+00:00'\\)\\)\n        date = s.strftime\\('%Y-%m-%d'\\)\n        date_counts[date] = date_counts.get\\(date, 0\\) + 1\n    except:\n        pass\nfor dt in sorted\\(date_counts\\):\n    bar = '#' * date_counts[dt]\n    print\\(f'  {dt}  {bar} \\({date_counts[dt]}\\)'\\)\n\n# Compare with all other buses combined\nother_events = [ev for ev in events if \\(ev.get\\('vehicle_name'\\) or ev.get\\('vehicle_id'\\)\\) != '18332']\nother_peaks = [ev.get\\('peak_occupation'\\) for ev in other_events if ev.get\\('peak_occupation'\\) is not None]\nother_caps = [ev.get\\('capacity'\\) for ev in other_events if ev.get\\('capacity'\\) is not None]\nother_durations = []\nfor ev in other_events:\n    try:\n        s = datetime.fromisoformat\\(ev['start_time'].replace\\('Z','+00:00'\\)\\)\n        e = datetime.fromisoformat\\(ev['end_time'].replace\\('Z','+00:00'\\)\\)\n        other_durations.append\\(\\(e - s\\).total_seconds\\(\\)\\)\n    except:\n        pass\n\nprint\\(f'\\\\n=== ALL OTHER BUSES \\({len\\(other_events\\)} events\\) ==='\\)\nif other_durations:\n    print\\(f'Duration avg: {sum\\(other_durations\\)/len\\(other_durations\\):.0f}s  median: {sorted\\(other_durations\\)[len\\(other_durations\\)//2]:.0f}s'\\)\nif other_peaks and other_caps:\n    ratios = [p/c for p,c in zip\\(other_peaks, other_caps\\) if c]\n    print\\(f'Peak/capacity ratio avg: {sum\\(ratios\\)/len\\(ratios\\):.2f}'\\)\n    ratios_18332 = [p/capacity for p in peaks if peaks]\n    print\\(f'18332 peak/capacity ratio avg: {sum\\(ratios_18332\\)/len\\(ratios_18332\\):.2f}'\\)\n\" 2>&1)",
      "Bash(curl -s -b /tmp/uts_fb.txt \"https://utsopsdashboard.com/api/fullbus?start=2026-02-01T00:00:00Z&end=2026-02-25T23:59:59Z\" | \"/c/Program Files/Python314/python.exe\" -c \"\nimport sys, json\nfrom datetime import datetime, timezone\n\nd = json.load\\(sys.stdin\\)\nevents = d.get\\('events', []\\) + d.get\\('active', []\\)\nprint\\(f'Total events: {len\\(events\\)}'\\)\n\n# Separate by vehicle\nby_vehicle = {}\nfor ev in events:\n    name = ev.get\\('vehicle_name'\\) or ev.get\\('vehicle_id'\\) or 'unknown'\n    by_vehicle.setdefault\\(name, []\\).append\\(ev\\)\n\nprint\\(f'\\\\nEvent count by vehicle:'\\)\nfor name, evs in sorted\\(by_vehicle.items\\(\\), key=lambda x: -len\\(x[1]\\)\\):\n    print\\(f'  {name}: {len\\(evs\\)} events'\\)\n\n# Deep dive on 18332\nevs_18332 = by_vehicle.get\\('18332', []\\)\nprint\\(f'\\\\n=== DEEP DIVE: bus 18332 \\({len\\(evs_18332\\)} events\\) ==='\\)\n\n# Duration stats\ndurations = []\nfor ev in evs_18332:\n    try:\n        s = datetime.fromisoformat\\(ev['start_time'].replace\\('Z','+00:00'\\)\\)\n        e = datetime.fromisoformat\\(ev['end_time'].replace\\('Z','+00:00'\\)\\)\n        dur = \\(e - s\\).total_seconds\\(\\)\n        durations.append\\(dur\\)\n    except:\n        durations.append\\(None\\)\n\nvalid_dur = [d for d in durations if d is not None]\nif valid_dur:\n    print\\(f'Duration stats \\(seconds\\):'\\)\n    print\\(f'  min={min\\(valid_dur\\):.0f}s  max={max\\(valid_dur\\):.0f}s  avg={sum\\(valid_dur\\)/len\\(valid_dur\\):.0f}s  median={sorted\\(valid_dur\\)[len\\(valid_dur\\)//2]:.0f}s'\\)\n    very_short = [d for d in valid_dur if d < 30]\n    print\\(f'  Episodes under 30s: {len\\(very_short\\)} \\({100*len\\(very_short\\)//len\\(valid_dur\\)}%\\)'\\)\n    very_long = [d for d in valid_dur if d > 300]\n    print\\(f'  Episodes over 5min: {len\\(very_long\\)} \\({100*len\\(very_long\\)//len\\(valid_dur\\)}%\\)'\\)\n\n# Peak occupation stats\npeaks = [ev.get\\('peak_occupation'\\) for ev in evs_18332 if ev.get\\('peak_occupation'\\) is not None]\ncapacity = evs_18332[0].get\\('capacity', 50\\) if evs_18332 else 50\nif peaks:\n    print\\(f'Peak occupation \\(capacity={capacity}\\):'\\)\n    print\\(f'  min={min\\(peaks\\)}  max={max\\(peaks\\)}  avg={sum\\(peaks\\)/len\\(peaks\\):.1f}'\\)\n    extreme = [p for p in peaks if p > capacity * 1.3]\n    print\\(f'  Suspiciously high \\(>130% capacity\\): {len\\(extreme\\)} events, values: {sorted\\(extreme, reverse=True\\)[:10]}'\\)\n\n# Time of day distribution\nprint\\(f'\\\\nTime of day distribution \\(ET, rough\\):'\\)\nhour_counts = {}\nfor ev in evs_18332:\n    try:\n        s = datetime.fromisoformat\\(ev['start_time'].replace\\('Z','+00:00'\\)\\)\n        # Approx ET = UTC-5\n        hour = \\(s.hour - 5\\) % 24\n        hour_counts[hour] = hour_counts.get\\(hour, 0\\) + 1\n    except:\n        pass\nfor h in sorted\\(hour_counts\\):\n    bar = '#' * hour_counts[h]\n    print\\(f'  {h:02d}:00  {bar} \\({hour_counts[h]}\\)'\\)\n\n# Date distribution\nprint\\(f'\\\\nDate distribution:'\\)\ndate_counts = {}\nfor ev in evs_18332:\n    try:\n        s = datetime.fromisoformat\\(ev['start_time'].replace\\('Z','+00:00'\\)\\)\n        date = s.strftime\\('%Y-%m-%d'\\)\n        date_counts[date] = date_counts.get\\(date, 0\\) + 1\n    except:\n        pass\nfor dt in sorted\\(date_counts\\):\n    bar = '#' * date_counts[dt]\n    print\\(f'  {dt}  {bar} \\({date_counts[dt]}\\)'\\)\n\n# Compare with all other buses combined\nother_events = [ev for ev in events if \\(ev.get\\('vehicle_name'\\) or ev.get\\('vehicle_id'\\)\\) != '18332']\nother_peaks = [ev.get\\('peak_occupation'\\) for ev in other_events if ev.get\\('peak_occupation'\\) is not None]\nother_caps = [ev.get\\('capacity'\\) for ev in other_events if ev.get\\('capacity'\\) is not None]\nother_durations = []\nfor ev in other_events:\n    try:\n        s = datetime.fromisoformat\\(ev['start_time'].replace\\('Z','+00:00'\\)\\)\n        e = datetime.fromisoformat\\(ev['end_time'].replace\\('Z','+00:00'\\)\\)\n        other_durations.append\\(\\(e - s\\).total_seconds\\(\\)\\)\n    except:\n        pass\n\nprint\\(f'\\\\n=== ALL OTHER BUSES \\({len\\(other_events\\)} events\\) ==='\\)\nif other_durations:\n    print\\(f'Duration avg: {sum\\(other_durations\\)/len\\(other_durations\\):.0f}s  median: {sorted\\(other_durations\\)[len\\(other_durations\\)//2]:.0f}s'\\)\nif other_peaks and other_caps:\n    ratios = [p/c for p,c in zip\\(other_peaks, other_caps\\) if c]\n    print\\(f'Peak/capacity ratio avg: {sum\\(ratios\\)/len\\(ratios\\):.2f}'\\)\n    ratios_18332 = [p/capacity for p in peaks if peaks]\n    print\\(f'18332 peak/capacity ratio avg: {sum\\(ratios_18332\\)/len\\(ratios_18332\\):.2f}'\\)\n\" 2>&1)"
    ]
  }
}
